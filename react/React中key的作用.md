Reactä¸­keyçš„ä½œç”¨
====
### keyçš„ä½œç”¨

reactä¸­çš„keyå±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼Œå®ƒæ˜¯å‡ºç°ä¸æ˜¯ç»™å¼€å‘è€…ç”¨çš„ï¼ˆä¾‹å¦‚ä½ ä¸ºä¸€ä¸ªç»„ä»¶è®¾ç½®keyä¹‹åä¸èƒ½è·å–ç»„ä»¶çš„è¿™ä¸ªkey propsï¼‰ï¼Œè€Œæ˜¯ç»™reactè‡ªå·±ç”¨çš„ã€‚
reactåˆ©ç”¨keyæ¥è¯†åˆ«ç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ç§èº«ä»½æ ‡è¯†æ ‡è¯†ï¼Œå°±åƒæˆ‘ä»¬çš„èº«ä»½è¯ç”¨æ¥è¾¨è¯†ä¸€ä¸ªäººä¸€æ ·ã€‚
æœ‰äº†keyå±æ€§åï¼Œå°±å¯ä»¥ä¸ç»„ä»¶å»ºç«‹äº†ä¸€ç§å¯¹åº”å…³ç³»ï¼Œreactæ ¹æ®keyæ¥å†³å®šæ˜¯é”€æ¯é‡æ–°åˆ›å»ºç»„ä»¶è¿˜æ˜¯æ›´æ–°ç»„ä»¶ã€‚
* keyç›¸åŒï¼Œè‹¥ç»„ä»¶å±æ€§æœ‰æ‰€å˜åŒ–ï¼Œåˆ™reactåªæ›´æ–°ç»„ä»¶å¯¹åº”çš„å±æ€§ï¼›æ²¡æœ‰å˜åŒ–åˆ™ä¸æ›´æ–°ã€‚
* keyå€¼ä¸åŒï¼Œåˆ™reactå…ˆé”€æ¯è¯¥ç»„ä»¶(æœ‰çŠ¶æ€ç»„ä»¶çš„componentWillUnmountä¼šæ‰§è¡Œ)ï¼Œç„¶åé‡æ–°åˆ›å»ºè¯¥ç»„ä»¶ï¼ˆæœ‰çŠ¶æ€ç»„ä»¶çš„constructorå’ŒcomponentWillUnmountéƒ½ä¼šæ‰§è¡Œï¼‰

keyçš„å€¼å¿…é¡»ä¿è¯å”¯ä¸€ä¸”ç¨³å®š

å¦å¤–éœ€è¦æŒ‡æ˜çš„æ˜¯:
#### keyä¸æ˜¯ç”¨æ¥æå‡reactçš„æ€§èƒ½çš„ï¼Œä¸è¿‡ç”¨å¥½keyå¯¹æ€§èƒ½æ˜¯æœ‰å¸®åŠ©çš„ã€‚

### keyçš„ä½¿ç”¨åœºæ™¯
åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œkeyå±æ€§çš„ä½¿ç”¨åœºæ™¯æœ€å¤šçš„è¿˜æ˜¯ç”±æ•°ç»„åŠ¨æ€åˆ›å»ºçš„å­ç»„ä»¶çš„æƒ…å†µï¼Œéœ€è¦ä¸ºæ¯ä¸ªå­ç»„ä»¶æ·»åŠ å”¯ä¸€çš„keyå±æ€§å€¼ã€‚

é‚£ä¹ˆï¼Œä¸ºä½•ç”±æ•°ç»„åŠ¨æ€åˆ›å»ºçš„ç»„ä»¶å¿…é¡»è¦ç”¨åˆ°keyå±æ€§å‘¢ï¼Ÿè¿™è·Ÿæ•°ç»„å…ƒç´ çš„åŠ¨æ€æ€§æœ‰å…³ã€‚

çœ‹ä¸€ä¸‹babelå¯¹ä¸Šè¿°ä»£ç çš„è½¬æ¢æƒ…å†µï¼š
```javascript
// è½¬æ¢å‰
const element = (
  <div>
    <h3>ç”¨æˆ·åˆ—è¡¨</h3>
    {[<div key={1}>1:å¼ ä¸‰</div>, <div key={2}>2:æå››</div>]}
  </div>
);

// è½¬æ¢å
"use strict";

var element = React.createElement(
  "div",
  null,
  React.createElement("h3",null,"ç”¨æˆ·åˆ—è¡¨"),
  [
    React.createElement("div",{ key: 1 },"1:å¼ ä¸‰"), 
    React.createElement("div",{ key: 2 },"2:æå››")
  ]
);
```
æœ‰babelè½¬æ¢åReact.createElementä¸­çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå…¶å®ƒå…ƒç´ ä¹‹æ‰€ä»¥ä¸æ˜¯å¿…é¡»éœ€è¦keyæ˜¯å› ä¸ºä¸ç®¡ç»„ä»¶çš„stateæˆ–è€…propså¦‚ä½•å˜åŒ–ï¼Œè¿™äº›å…ƒç´ å§‹ç»ˆå æ®ç€React.createElementå›ºå®šçš„ä½ç½®ï¼Œè¿™ä¸ªä½ç½®å°±æ˜¯å¤©ç„¶çš„key

è€Œç”±æ•°ç»„åˆ›å»ºçš„ç»„ä»¶å¯èƒ½ç”±äºåŠ¨æ€çš„æ“ä½œå¯¼è‡´é‡æ–°æ¸²æŸ“æ—¶ï¼Œå­ç»„ä»¶çš„ä½ç½®å‘ç”Ÿäº†å˜åŒ–ï¼Œä¾‹å¦‚ä¸Šé¢ç”¨æˆ·åˆ—è¡¨å­ç»„ä»¶æ–°å¢ä¸€ä¸ªç”¨æˆ·ï¼Œä¸Šé¢ä¸¤ä¸ªç”¨æˆ·çš„ä½ç½®å¯èƒ½å˜åŒ–ä¸ºä¸‹é¢è¿™æ ·ï¼š
```javascript
var element = React.createElement(
  "div",
  null,
  React.createElement("h3",null,"ç”¨æˆ·åˆ—è¡¨"),
  [
    React.createElement("div",{ key: 3 },"1:ç‹äº”"), 
    React.createElement("div",{ key: 1 },"2:å¼ ä¸‰"), 
    React.createElement("div",{ key: 2 },"3:æå››")
  ]
);
```
å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ¯”è¾ƒå¸¸è§çš„åœºæ™¯ï¼š
ä¸ºä¸€ä¸ªæœ‰å¤æ‚ç¹çé€»è¾‘çš„ç»„ä»¶æ·»åŠ keyåï¼Œåç»­æ“ä½œå¯ä»¥æ”¹å˜è¯¥ç»„ä»¶çš„keyå±æ€§å€¼ï¼Œä»è€Œè¾¾åˆ°å…ˆé”€æ¯ä¹‹å‰çš„ç»„ä»¶ï¼Œå†é‡æ–°åˆ›å»ºè¯¥ç»„ä»¶

### keyçš„æœ€ä½³å®è·µ
ä¸Šé¢è¯´åˆ°äº†ï¼Œç”±æ•°ç»„åˆ›å»ºçš„å­ç»„ä»¶å¿…é¡»æœ‰keyå±æ€§ï¼Œå¦åˆ™çš„è¯ä½ å¯èƒ½è§åˆ°ä¸‹é¢è¿™æ ·çš„warningï¼š
<code>Warning: Each child in an array or iterator should have a unique "key" prop. Check the render method of `ServiceInfo`. See https://fb.me/react-warning-keys for more information.</code>

å¯èƒ½ä½ ä¼šå‘ç°ï¼Œè¿™åªæ˜¯warningè€Œä¸æ˜¯errorï¼Œå®ƒä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä¸ºä»€ä¹ˆreactä¸å¼ºåˆ¶è¦æ±‚ç”¨keyè€ŒæŠ¥errorå‘¢ï¼Ÿå…¶å®æ˜¯å¼ºåˆ¶è¦æ±‚çš„ï¼Œåªä¸è¿‡reactä¸ºæŒ‰è¦æ±‚æ¥é»˜è®¤ä¸Šå¸®æˆ‘ä»¬åšäº†ï¼Œå®ƒæ˜¯ä»¥æ•°ç»„çš„indexä½œä¸ºkeyçš„
#### indexä½œä¸ºkeyæ˜¯ä¸€ç§åæ¨¡å¼
åœ¨listæ•°ç»„ä¸­ï¼Œç”¨keyæ¥æ ‡è¯†æ•°ç»„åˆ›å»ºå­ç»„ä»¶æ—¶ï¼Œè‹¥æ•°ç»„çš„å†…å®¹åªæ˜¯ä½œä¸ºçº¯å±•ç¤ºï¼Œè€Œä¸æ¶‰åŠåˆ°æ•°ç»„çš„åŠ¨æ€å˜æ›´ï¼Œå…¶å®æ˜¯å¯ä»¥ä½¿ç”¨indexä½œä¸ºkeyçš„ã€‚

ä½†æ˜¯ï¼Œè‹¥æ¶‰åŠåˆ°æ•°ç»„çš„åŠ¨æ€å˜æ›´ï¼Œä¾‹å¦‚æ•°ç»„æ–°å¢å…ƒç´ ã€åˆ é™¤å…ƒç´ æˆ–è€…é‡æ–°æ’åºç­‰ï¼Œè¿™æ—¶indexä½œä¸ºkeyä¼šå¯¼è‡´å±•ç¤ºé”™è¯¯çš„æ•°æ®ã€‚æœ¬æ–‡å¼€å§‹å¼•å…¥çš„ä¾‹å­å°±æ˜¯æœ€å¥½çš„è¯æ˜ã€‚


index çš„æ›¿ä»£

å½’æ ¹ç»“åº•ï¼Œä½¿ç”¨indexçš„é—®é¢˜åœ¨äºä¸¤æ¬¡æ¸²æŸ“çš„indexæ˜¯ç›¸åŒçš„ï¼Œå¯¼è‡´keyä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œå›åˆ°ä¸Šé¢ğŸ‘†çš„æ€»ç»“ ï¼škeyç›¸åŒï¼Œè‹¥ç»„ä»¶å±æ€§æœ‰æ‰€å˜åŒ–ï¼Œåˆ™reactåªæ›´æ–°ç»„ä»¶å¯¹åº”çš„å±æ€§ï¼›æ²¡æœ‰å˜åŒ–åˆ™ä¸æ›´æ–°ã€‚
è¿™æ—¶å€™ï¼Œå¦‚æœä¿è¯æ¯æ¬¡çš„ key ä¸åŒï¼Œé—®é¢˜ä¸å°±è§£å†³äº†ä¹ˆï¼Ÿ
äºæ˜¯ä¹Â·Â·Â·
```javascript
key={index +  Math.random()}
```
å¤åˆ¶ä»£ç ä¸€è¡Œç¥å¥‡çš„ä»£ç å°±äº§ç”Ÿäº†ã€‚
èƒ½è§£å†³é—®é¢˜ä¹ˆï¼Ÿèƒ½ï¼æ˜¯æœ€ä¼˜çš„ä¹ˆï¼Ÿä¸æ˜¯ã€‚

keyåº”è¯¥æ˜¯ç¨³å®šçš„ï¼Œå¯é¢„æµ‹çš„å’Œç‹¬ç‰¹çš„ã€‚ä¸ç¨³å®šçš„keyï¼ˆå¦‚ç”±å…¶ç”Ÿæˆçš„key Math.random()ï¼‰å°†å¯¼è‡´è®¸å¤šç»„ä»¶å®ä¾‹å’ŒDOMèŠ‚ç‚¹è¢«ä¸å¿…è¦åœ°é‡æ–°åˆ›å»ºï¼Œè¿™å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™å’Œå­ç»„ä»¶ä¸­çš„ä¸¢å¤±çŠ¶æ€ã€‚
æ‰€ä»¥ï¼Œåœ¨ä¸èƒ½ä½¿ç”¨randoméšæœºç”Ÿæˆkeyæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·ç”¨ä¸€ä¸ªå…¨å±€çš„localCounterå˜é‡æ¥æ·»åŠ ç¨³å®šå”¯ä¸€çš„keyå€¼ã€‚
```javascript
var localCounter = 1;
this.data.forEach(el=>{
    el.id = localCounter++;
});
//å‘æ•°ç»„ä¸­åŠ¨æ€æ·»åŠ å…ƒç´ æ—¶ï¼Œ
function createUser(user) {
    return {
        ...user,
        id: localCounter++
    }
}

```
æ‰€ä»¥ï¼Œæˆ‘æœ€åçš„è§£å†³æ–¹æ¡ˆæ˜¯å…¨å±€å®šä¹‰ä¸€ä¸ªå˜é‡ï¼šlet ONE = 1;,ç„¶ååœ¨ç»„ä»¶ä¸­ä½¿ç”¨ key = {ONE++} ã€‚è¿™æ · setSete() çš„æ—¶å€™æ¯æ¬¡keyéƒ½äº§ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿä¸€å®šç¨‹åº¦ä¸Šé¿å…äº†keyçš„ä¸ç¨³å®šæ€§è´¨